
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Analyzing Network Data with Unknown Community Structure &#8212; probinet  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/Unknown_structure';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bibliography" href="../references.html" />
    <link rel="prev" title="Cross-Validation And Anomaly Detection With The ACD Algorithm" href="ACD.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">probinet  documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html">API</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.input.html">probinet.input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.input.loader.html">probinet.input.loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.input.preprocessing.html">probinet.input.preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.input.stats.html">probinet.input.stats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.models.html">probinet.models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.models.crep.html">probinet.models.crep</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.models.jointcrep.html">probinet.models.jointcrep</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.models.dyncrep.html">probinet.models.dyncrep</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.models.mtcov.html">probinet.models.mtcov</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.models.acd.html">probinet.models.acd</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.models.base.html">probinet.models.base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.models.constants.html">probinet.models.constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.models.classes.html">probinet.models.classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.main.html">probinet.main</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.version.html">probinet.version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.synthetic.html">probinet.synthetic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.synthetic.anomaly.html">probinet.synthetic.anomaly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.synthetic.base.html">probinet.synthetic.base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.synthetic.dynamic.html">probinet.synthetic.dynamic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.synthetic.multilayer.html">probinet.synthetic.multilayer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.synthetic.reciprocity.html">probinet.synthetic.reciprocity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.model_selection.html">probinet.model_selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.model_selection.parameter_search.html">probinet.model_selection.parameter_search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.model_selection.cross_validation.html">probinet.model_selection.cross_validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.model_selection.mtcov_cross_validation.html">probinet.model_selection.mtcov_cross_validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.model_selection.dyncrep_cross_validation.html">probinet.model_selection.dyncrep_cross_validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.model_selection.main.html">probinet.model_selection.main</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.model_selection.masking.html">probinet.model_selection.masking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.model_selection.acd_cross_validation.html">probinet.model_selection.acd_cross_validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.model_selection.crep_cross_validation.html">probinet.model_selection.crep_cross_validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.model_selection.jointcrep_cross_validation.html">probinet.model_selection.jointcrep_cross_validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.model_selection.labeling.html">probinet.model_selection.labeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.model_selection.html">probinet.model_selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.utils.html">probinet.utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.utils.matrix_operations.html">probinet.utils.matrix_operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.utils.tools.html">probinet.utils.tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.visualization.html">probinet.visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generated/probinet.visualization.plot.html">probinet.visualization.plot</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="MTCOV.html">A Beginner's Guide To The MTCOV Algorithm In The Probinet Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="CRep.html">Generation Of Synthetic Networks Using The CRep Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="JointCRep.html">Analysis Of A Real-World Dataset Using The JointCRep Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="DynCRep.html">Decoding Temporal Relationships With DynCRep</a></li>
<li class="toctree-l1"><a class="reference internal" href="ACD.html">Cross-Validation And Anomaly Detection With The ACD Algorithm</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Analyzing Network Data With Unknown Community Structure</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">References</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../references.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/tutorials/Unknown_structure.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Analyzing Network Data with Unknown Community Structure</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inferring-the-communities-with-no-prior-information-about-the-structure-of-the-data">Inferring the Communities with No Prior Information About the Structure of the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="analyzing-network-data-with-unknown-community-structure">
<h1>Analyzing Network Data with Unknown Community Structure<a class="headerlink" href="#analyzing-network-data-with-unknown-community-structure" title="Link to this heading">#</a></h1>
<p>In this tutorial, we’ll walk you through the process of analyzing network data when you suspect a community structure exists but aren’t sure what kind. We’ll explore what to do if the inferred latent variables aren’t informative and how to improve results by better initializing parameters. A key concept in this tutorial is the assortative and disassortative structure of networks.</p>
<blockquote>
<div><p><strong><em>Quick Recap:</em></strong></p>
<ul class="simple">
<li><p><strong>Assortative Structure</strong>: In an assortative network, nodes tend to connect to other nodes that are similar to them. For example, in a social network, people might be more likely to connect with others who share similar interests or characteristics.</p></li>
<li><p><strong>Disassortative Structure</strong>: In a disassortative network, nodes tend to connect to other nodes that are different from them. For example, in a biological network, certain types of proteins might be more likely to interact with proteins that have different functions.</p></li>
</ul>
</div></blockquote>
<section id="inferring-the-communities-with-no-prior-information-about-the-structure-of-the-data">
<h2>Inferring the Communities with No Prior Information About the Structure of the Data<a class="headerlink" href="#inferring-the-communities-with-no-prior-information-about-the-structure-of-the-data" title="Link to this heading">#</a></h2>
<p>In this section, we’ll learn how to infer community structures without knowing if the network is assortative or disassortative.</p>
<p>First, we load the network data using the <code class="docutils literal notranslate"><span class="pre">build_adjacency_from_file</span></code> function from the <code class="docutils literal notranslate"><span class="pre">probinet</span> <span class="pre">.input.loader</span></code> module. This function builds both the graph object and the adjacency matrix (showing node connections) from a file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">probinet.input.loader</span> <span class="kn">import</span> <span class="n">build_adjacency_from_file</span>

<span class="c1"># Define the file path</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;inputs/network_A_200_1_3_25_10.csv&quot;</span>

<span class="c1"># Load the graph object from the file</span>
<span class="n">gdata</span> <span class="o">=</span> <span class="n">build_adjacency_from_file</span><span class="p">(</span>
    <span class="n">file_path</span><span class="p">,</span>
    <span class="n">ego</span><span class="o">=</span><span class="s2">&quot;source&quot;</span><span class="p">,</span>
    <span class="n">alter</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
    <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
    <span class="n">undirected</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Print the names of the coordinates in the namedtuple gdata</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gdata</span><span class="o">.</span><span class="n">_fields</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;graph_list&#39;, &#39;adjacency_tensor&#39;, &#39;transposed_tensor&#39;, &#39;data_values&#39;, &#39;nodes&#39;, &#39;design_matrix&#39;)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/runner/.local/lib/python3.10/site-packages/probinet/input/loader.py:315: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  if row[layer + 2] &gt; 0:
/home/runner/.local/lib/python3.10/site-packages/probinet/input/loader.py:328: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  edge_attributes = {label: int(row[layer + 2])}
</pre></div>
</div>
</div>
</div>
<p>Now that we have the data, let’s print some basic statistics about the graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">probinet.input.stats</span> <span class="kn">import</span> <span class="n">print_graph_stat</span>

<span class="c1"># Import the logging module</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1"># Get the root logger and set its level to INFO</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Set the logging level for matplotlib to WARNING</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

<span class="c1"># Call the `print_graph_stat` function to print the basic</span>
<span class="c1"># statistics of the graphs in the list `A`.</span>
<span class="n">print_graph_stat</span><span class="p">(</span><span class="n">gdata</span><span class="o">.</span><span class="n">graph_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:root:Number of nodes = 200
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:root:Number of layers = 1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:root:Number of edges and average degree in each layer:
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:root:E[0] = 2314 / &lt;k&gt; = 23.14
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:root:M[0] = 2542 - &lt;k_weighted&gt; = 25.420
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:root:Sparsity [0] = 0.058
</pre></div>
</div>
</div>
</div>
<p>The graph has 200 nodes and one layer, with approximately 2300 edges. The average degree (the number of connections per node) is about 23. The network is undirected, therefore reciprocity is meaningless.</p>
<p>Now that we have an overview of the network, we can infer its community structure. We’ll use the
MTCOV <span id="id1">[<a class="reference internal" href="../references.html#id2" title="Martina Contisciani, Eleanor A Power, and Caterina De Bacco. Community detection with node attributes in multilayer networks. Scientific reports, 10(1):15736, 2020.">CPDB20</a>]</span> class from the <code class="docutils literal notranslate"><span class="pre">pgm.model.mtcov</span></code> module. Before running
the algorithm, we adjust some
key parameters, such as the number of realizations and the maximum iterations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">probinet.models.mtcov</span> <span class="kn">import</span> <span class="n">MTCOV</span>

<span class="c1"># Define the number of realizations</span>
<span class="n">NUM_REAL</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">MAX_ITER</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">DECISION</span> <span class="o">=</span> <span class="mi">15</span>

<span class="c1"># Create an instance of the `MTCOV` class</span>
<span class="n">mtcov_unbiased</span> <span class="o">=</span> <span class="n">MTCOV</span><span class="p">(</span><span class="n">num_realizations</span><span class="o">=</span><span class="n">NUM_REAL</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="n">MAX_ITER</span><span class="p">,</span> <span class="n">decision</span><span class="o">=</span><span class="n">DECISION</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we run the algorithm by passing the data to the fit method of the MTCOV class. This
method requires both the <strong>structural data</strong> (the connections between nodes) and a <strong>design matrix</strong>
<code class="docutils literal notranslate"><span class="pre">X</span></code>, which contains attributes of the nodes that can help infer community structure. In our case,
since we don’t have any node attributes, we pass a matrix of zeros.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Generate dummy data for the design matrix (zeros).</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">gdata</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>The algorithm also requires a <code class="docutils literal notranslate"><span class="pre">GraphData</span></code> object, which contains the structural data and the
design matrix. We have already imported part of it. Now we need to replace the design matrix with
a dummy one (the output given by the <code class="docutils literal notranslate"><span class="pre">build_adjacency_from_file</span></code> function contains a design
matrix that is set to None).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print the design matrix of the `GraphData` object</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gdata</span><span class="o">.</span><span class="n">design_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace the design matrix with the dummy data</span>
<span class="n">gdata</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">design_matrix</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We fix the number of communities to 3 and set the gamma parameter to 0, effectively ignoring any information in the design matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the number of communities and the gamma parameter</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">GAMMA</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<p>Since we have no prior knowledge of the network’s structure, we run the algorithm without any bias. To achieve this, we set the assortative parameter to False. This tells the algorithm not to enforce an assortative structure for the network, but it does not prevent inferring such structure if it is the optimal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the assortative parameter</span>
<span class="n">ASSORTATIVE</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the `MTCOV` model</span>
<span class="n">mtcov_unbiased</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">gdata</span><span class="p">,</span>
    <span class="n">gamma</span><span class="o">=</span><span class="n">GAMMA</span><span class="p">,</span>
    <span class="n">K</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">nodes</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
    <span class="n">out_inference</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">initialization</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">assortative</span><span class="o">=</span><span class="n">ASSORTATIVE</span><span class="p">,</span>
    <span class="n">undirected</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:root:gamma = 0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:root:Algorithm did not converge.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Solution failed to converge in 500 EM steps!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Parameters won&#39;t be saved for this realization! If you have provided a number of realizations equal to one, please increase it.
</pre></div>
</div>
</div>
</div>
<p>After running the algorithm, we can examine the inferred latent variables by plotting them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="k">def</span> <span class="nf">plot_matrices</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="c1"># Plot u</span>
    <span class="n">plot0</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
        <span class="n">plot0</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$U$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># Plot v</span>
    <span class="n">plot1</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
        <span class="n">plot1</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$V$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># Plot w</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">plot2</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">plot2</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
        <span class="n">plot2</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$W$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_matrices</span><span class="p">(</span>
    <span class="n">mtcov_unbiased</span><span class="o">.</span><span class="n">u</span><span class="p">,</span>
    <span class="n">mtcov_unbiased</span><span class="o">.</span><span class="n">v</span><span class="p">,</span>
    <span class="n">mtcov_unbiased</span><span class="o">.</span><span class="n">w</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e41ba0cc3852ea07e5e1d5dbda29d0cd63d34131bf1952c127204fb6ba4dd81a.png" src="../_images/e41ba0cc3852ea07e5e1d5dbda29d0cd63d34131bf1952c127204fb6ba4dd81a.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">u</span></code> and <code class="docutils literal notranslate"><span class="pre">v</span></code> matrices represent node memberships for outgoing and incoming communities, respectively. Here, they are identical since the network is undirected. The plot shows that the top nodes predominantly belong to the third community, while the bottom nodes are mainly part of the first. The nodes in the middle exhibit instead mixed memberships across these groups. Looking at the affinity matrix <code class="docutils literal notranslate"><span class="pre">w</span></code>, we observe that the strongest connections are between nodes in the second community, although this community is small and shows high mixed membership levels. However, we can also notice that nodes in the first community interact exclusively with nodes in the third, hinting at a disassortative structure.</p>
<p>Even though there is some indication of a disassortative structure, it is not clear, and the
mixed membership values make interpretation challenging. This may be due to the algorithm getting
trapped in a local minimum. In this case, we ran the algorithm with a random initialization of
the latent variables, and with no bias toward any specific structure. This raises the question: can we improve the approach? The answer is yes. For example, if we suspect a disassortative structure, we could introduce a bias in the model to guide it in that direction.</p>
<p>To do this, we generate new matrices for <code class="docutils literal notranslate"><span class="pre">u</span></code>, <code class="docutils literal notranslate"><span class="pre">v</span></code>, <code class="docutils literal notranslate"><span class="pre">beta</span></code>, and <code class="docutils literal notranslate"><span class="pre">w</span></code> (the latent variables normally
inferred by the model) and
save them to a file.
To bias the algorithm towards a disassortative structure, we set the diagonal of the <code class="docutils literal notranslate"><span class="pre">w</span></code> matrix to a small value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fix the random seed for reproducibility</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdata</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
<span class="c1"># Generate initial guesses for u and v</span>
<span class="n">initial_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">K</span><span class="p">))</span>
<span class="n">initial_v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">K</span><span class="p">))</span>
<span class="c1"># Generate random sample for w of size KxK</span>
<span class="n">initial_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_sample</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">K</span><span class="p">))</span>
<span class="c1"># Make the diagonal almost zero by multiplying it by a small number</span>
<span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">initial_w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="c1"># Generate a dummy beta</span>
<span class="n">initial_beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">K</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># Define the output file path</span>
<span class="n">outfile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;outputs/theta_for_init.npz&quot;</span><span class="p">)</span>

<span class="c1"># Save the variables to a .npz file</span>
<span class="n">np</span><span class="o">.</span><span class="n">savez_compressed</span><span class="p">(</span>
    <span class="n">outfile</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">initial_u</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">initial_v</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">initial_w</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">initial_beta</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">nodes</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we’re ready to run the algorithm! In addition to setting key parameters, we can also specify the file path where the initial guesses for the latent variables are stored.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instantiate the `MTCOV` class</span>
<span class="n">mtcov_disassortative</span> <span class="o">=</span> <span class="n">MTCOV</span><span class="p">(</span>
    <span class="n">num_realizations</span><span class="o">=</span><span class="n">NUM_REAL</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="n">MAX_ITER</span><span class="p">,</span> <span class="n">decision</span><span class="o">=</span><span class="n">DECISION</span>
<span class="p">)</span>

<span class="c1"># Define the assortative parameter</span>
<span class="n">ASSORTATIVE</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Run the `MTCOV` model</span>
<span class="n">mtcov_disassortative</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">gdata</span><span class="p">,</span>
    <span class="n">gamma</span><span class="o">=</span><span class="n">GAMMA</span><span class="p">,</span>
    <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span>
    <span class="n">nodes</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
    <span class="n">out_inference</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">assortative</span><span class="o">=</span><span class="n">ASSORTATIVE</span><span class="p">,</span>
    <span class="n">undirected</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">initialization</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">files</span><span class="o">=</span><span class="n">outfile</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:root:gamma = 0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:root:Algorithm did not converge.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Solution failed to converge in 500 EM steps!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Parameters won&#39;t be saved for this realization! If you have provided a number of realizations equal to one, please increase it.
</pre></div>
</div>
</div>
</div>
<p>Let’s visualize the results by plotting the latent variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_matrices</span><span class="p">(</span>
    <span class="n">mtcov_disassortative</span><span class="o">.</span><span class="n">u</span><span class="p">,</span>
    <span class="n">mtcov_disassortative</span><span class="o">.</span><span class="n">v</span><span class="p">,</span>
    <span class="n">mtcov_disassortative</span><span class="o">.</span><span class="n">w</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0132b34b07a7a59386378429b857899fa15fc6717697c8ec97154c179c50f576.png" src="../_images/0132b34b07a7a59386378429b857899fa15fc6717697c8ec97154c179c50f576.png" />
</div>
</div>
<p>Good news! The algorithm successfully escaped the local minimum and found a more informative set of latent variables. The <code class="docutils literal notranslate"><span class="pre">w</span></code> matrix now shows a clear disassortative structure, with diagonal values close to zero, indicating weak intra-community connections. Moreover, the <code class="docutils literal notranslate"><span class="pre">u</span></code> and <code class="docutils literal notranslate"><span class="pre">v</span></code> matrices reveal a distinct assignment of nodes into the three communities.</p>
<p>To complete the analysis, we show what would happen if we force the model to look for an assortative community structure. This can be done simply by setting the assortative flag to True.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instantiate the `MTCOV` class</span>
<span class="n">mtcov_assortative</span> <span class="o">=</span> <span class="n">MTCOV</span><span class="p">(</span>
    <span class="n">num_realizations</span><span class="o">=</span><span class="n">NUM_REAL</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="n">MAX_ITER</span><span class="p">,</span> <span class="n">decision</span><span class="o">=</span><span class="n">DECISION</span>
<span class="p">)</span>

<span class="c1"># Define the assortative parameter</span>
<span class="n">ASSORTATIVE</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Run the `MTCOV` model</span>
<span class="n">mtcov_assortative</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">gdata</span><span class="p">,</span>
    <span class="n">gamma</span><span class="o">=</span><span class="n">GAMMA</span><span class="p">,</span>
    <span class="n">K</span><span class="o">=</span><span class="n">K</span><span class="p">,</span>
    <span class="n">nodes</span><span class="o">=</span><span class="n">gdata</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
    <span class="n">out_inference</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">initialization</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">assortative</span><span class="o">=</span><span class="n">ASSORTATIVE</span><span class="p">,</span>
    <span class="n">undirected</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:root:gamma = 0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:root:Algorithm did not converge.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Solution failed to converge in 500 EM steps!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Parameters won&#39;t be saved for this realization! If you have provided a number of realizations equal to one, please increase it.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_matrices</span><span class="p">(</span>
    <span class="n">mtcov_assortative</span><span class="o">.</span><span class="n">u</span><span class="p">,</span>
    <span class="n">mtcov_assortative</span><span class="o">.</span><span class="n">v</span><span class="p">,</span>
    <span class="n">mtcov_assortative</span><span class="o">.</span><span class="n">w</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6ce2de9ee82f75ba37759d1524dff9a83035f8f09b70e0dad28b41ffc2e12e5a.png" src="../_images/6ce2de9ee82f75ba37759d1524dff9a83035f8f09b70e0dad28b41ffc2e12e5a.png" />
</div>
</div>
<p>The affinity matrix <code class="docutils literal notranslate"><span class="pre">w</span></code> display the constrained assortative structure, while the node memberships present a mixed partition that is difficult to interpret from this visualization alone.</p>
<p>So far the analysis has been done visually, but we can also quantify the quality of the inferred community structure using various metrics.
For example, we could compare the log-likelihood of different models to identify the one with the lowest (best) value.</p>
<p>Alternatively, we could use reconstruction metrics, such as the L1 loss and AUC, to compare the input adjacency matrix against the inferred matrices.
For this option, we need to construct the matrices from the inferred latent variables. This can be done using the <code class="docutils literal notranslate"><span class="pre">lambda0_full</span></code> function from the <code class="docutils literal notranslate"><span class="pre">pgm.output.evaluate</span></code> module, which calculates the matrix <code class="docutils literal notranslate"><span class="pre">M</span></code> based from the latent variables <code class="docutils literal notranslate"><span class="pre">u</span></code>, <code class="docutils literal notranslate"><span class="pre">v</span></code>, and <code class="docutils literal notranslate"><span class="pre">w</span></code>. The following cell demonstrates how to compute and visualize these matrices.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">probinet.evaluation.expectation_computation</span> <span class="kn">import</span> <span class="n">compute_mean_lambda0</span>


<span class="k">def</span> <span class="nf">plot_matrix</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
        <span class="n">plot</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">matrix</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">matrix</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>


<span class="c1"># Plotting the matrices</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Plot matrix A</span>
<span class="n">adjacency_matrix</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">to_scipy_sparse_array</span><span class="p">(</span><span class="n">gdata</span><span class="o">.</span><span class="n">graph_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">adjacency_matrix</span> <span class="o">=</span> <span class="n">adjacency_matrix</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">plot_matrix</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">adjacency_matrix</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span>

<span class="c1"># Plot matrix M from mtcov_unbiased</span>
<span class="n">M_unbiased</span> <span class="o">=</span> <span class="n">compute_mean_lambda0</span><span class="p">(</span><span class="n">mtcov_unbiased</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">mtcov_unbiased</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">mtcov_unbiased</span><span class="o">.</span><span class="n">w</span><span class="p">)[</span>
    <span class="mi">0</span>
<span class="p">]</span>
<span class="n">plot_matrix</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">M_unbiased</span><span class="p">,</span> <span class="s2">&quot;M (unbiased)&quot;</span><span class="p">)</span>

<span class="c1"># Plot matrix M from mtcov_disassortative</span>
<span class="n">M_disassortative</span> <span class="o">=</span> <span class="n">compute_mean_lambda0</span><span class="p">(</span>
    <span class="n">mtcov_disassortative</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">mtcov_disassortative</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">mtcov_disassortative</span><span class="o">.</span><span class="n">w</span>
<span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">plot_matrix</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">M_disassortative</span><span class="p">,</span> <span class="s2">&quot;M (disassortative)&quot;</span><span class="p">)</span>

<span class="c1"># Plot matrix M from mtcov_assortative</span>
<span class="n">M_assortative</span> <span class="o">=</span> <span class="n">compute_mean_lambda0</span><span class="p">(</span>
    <span class="n">mtcov_assortative</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">mtcov_assortative</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">mtcov_assortative</span><span class="o">.</span><span class="n">w</span>
<span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">plot_matrix</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">M_assortative</span><span class="p">,</span> <span class="s2">&quot;M (assortative)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/aa0e1dcd6c942372c58c709f9af149be7c320c7c9d5b0296d1c1abae6e3d3d2e.png" src="../_images/aa0e1dcd6c942372c58c709f9af149be7c320c7c9d5b0296d1c1abae6e3d3d2e.png" />
</div>
</div>
<p>The first matrix shows the adjacency matrix <code class="docutils literal notranslate"><span class="pre">A</span></code>, capturing the connections between nodes.
The other matrices display the inferred matrices <code class="docutils literal notranslate"><span class="pre">M</span></code> (representing the expected values) for the three cases we explored. We
can now summarize the models’ performance with the log-likelihood, the L1 loss, and the AUC.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">probinet.evaluation.likelihood</span> <span class="kn">import</span> <span class="n">log_likelihood_given_model</span>
<span class="kn">from</span> <span class="nn">probinet.evaluation.expectation_computation</span> <span class="kn">import</span> <span class="n">compute_L1loss</span>
<span class="kn">from</span> <span class="nn">probinet.evaluation.link_prediction</span> <span class="kn">import</span> <span class="n">compute_link_prediction_AUC</span>

<span class="c1"># Calculate the metrics</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Matrix&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;M (unbiased)&quot;</span><span class="p">,</span> <span class="s2">&quot;M (disassortative)&quot;</span><span class="p">,</span> <span class="s2">&quot;M (assortative)&quot;</span><span class="p">],</span>
    <span class="s2">&quot;Log-likelihood&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">log_likelihood_given_model</span><span class="p">(</span><span class="n">mtcov_unbiased</span><span class="p">,</span> <span class="n">gdata</span><span class="o">.</span><span class="n">adjacency_tensor</span><span class="p">),</span>
        <span class="n">log_likelihood_given_model</span><span class="p">(</span><span class="n">mtcov_disassortative</span><span class="p">,</span> <span class="n">gdata</span><span class="o">.</span><span class="n">adjacency_tensor</span><span class="p">),</span>
        <span class="n">log_likelihood_given_model</span><span class="p">(</span><span class="n">mtcov_assortative</span><span class="p">,</span> <span class="n">gdata</span><span class="o">.</span><span class="n">adjacency_tensor</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;L1 Loss&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">compute_L1loss</span><span class="p">(</span><span class="n">adjacency_matrix</span><span class="p">,</span> <span class="n">M_unbiased</span><span class="p">),</span>
        <span class="n">compute_L1loss</span><span class="p">(</span><span class="n">adjacency_matrix</span><span class="p">,</span> <span class="n">M_disassortative</span><span class="p">),</span>
        <span class="n">compute_L1loss</span><span class="p">(</span><span class="n">adjacency_matrix</span><span class="p">,</span> <span class="n">M_assortative</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">compute_link_prediction_AUC</span><span class="p">(</span><span class="n">adjacency_matrix</span><span class="p">,</span> <span class="n">M_unbiased</span><span class="p">),</span>
        <span class="n">compute_link_prediction_AUC</span><span class="p">(</span><span class="n">adjacency_matrix</span><span class="p">,</span> <span class="n">M_disassortative</span><span class="p">),</span>
        <span class="n">compute_link_prediction_AUC</span><span class="p">(</span><span class="n">adjacency_matrix</span><span class="p">,</span> <span class="n">M_assortative</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Create a DataFrame</span>
<span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="c1"># Round the numbers to three decimal places</span>
<span class="n">df_results</span> <span class="o">=</span> <span class="n">df_results</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">df_results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Matrix</th>
      <th>Log-likelihood</th>
      <th>L1 Loss</th>
      <th>AUC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>M (unbiased)</td>
      <td>-14226.442</td>
      <td>0.213</td>
      <td>0.684</td>
    </tr>
    <tr>
      <th>1</th>
      <td>M (disassortative)</td>
      <td>-13653.129</td>
      <td>0.211</td>
      <td>0.699</td>
    </tr>
    <tr>
      <th>2</th>
      <td>M (assortative)</td>
      <td>-14924.255</td>
      <td>0.219</td>
      <td>0.629</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As shown in the table, the model biased towards a disassortative structure performs the best,
achieving the lowest log-likelihood, the lowest L1 loss, and the highest AUC. However, the differences compared to the unbiased model are minimal, indicating that the parameters inferred in the unbiased model were close to optimal. Conversely, the model biased towards an assortative structure performs the worst.</p>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>In this tutorial, we explored how to infer community structures in network data without prior
knowledge of whether the network is assortative or disassortative. Initially, we ran the
algorithm with random initialization and no bias, which resulted in unclear latent
variables. By adjusting the parameters and providing a better initialization, we guided the
algorithm out of a local minimum, successfully revealing a stronger community structure.
We also quantified the quality of the inferred structures by comparing the models’ log-likelihood and their perfomance in reconstruction. For the latter option, we calculated the L1 loss and the AUC between the adjacency matrix and the inferred
ones.</p>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ACD.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Cross-Validation And Anomaly Detection With The <code class="docutils literal notranslate"><span class="pre">ACD</span></code> Algorithm</p>
      </div>
    </a>
    <a class="right-next"
       href="../references.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Bibliography</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inferring-the-communities-with-no-prior-information-about-the-structure-of-the-data">Inferring the Communities with No Prior Information About the Structure of the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Diego Baptista Theuerkauf
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Max Planck Society / Software Workshop - Max Planck Institute for Intelligent Systems.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>